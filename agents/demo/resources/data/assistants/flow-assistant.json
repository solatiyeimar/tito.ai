{
    "id": "flow-assistant",
    "name": "ITM Help Desk Flow Bot",
    "description": "Flow-based bot for ITM Help Desk with dynamic configuration.",
    "architecture_type": "flow",
    "pipeline_settings": {
        "speak_first": true
    },
    "agent": {
        "provider": "openai",
        "model": "gpt-4o",
        "temperature": 0.0,
        "system_prompt": "You are a helpful assistant."
    },
    "io_layer": {
        "type": "webrtc",
        "transport": {
            "provider": "daily"
        },
        "stt": {
            "provider": "deepgram",
            "model": "nova-2-general",
            "language": "multi"
        },
        "tts": {
            "provider": "cartesia",
            "voice_id": "79a125e8-cd45-4c13-8a67-188112f4dd22"
        }
    },
    "flow": {
        "initial_node": "greeting_and_consent",
        "nodes": {
            "greeting_and_consent": {
                "messages": [
                    {
                        "role": "system",
                        "content": "<role>\nYou are a helpful assistant.\n</role>\n\n<task>\nYour task is to greet the user, introduce yourself, and obtain consent to record the call. You must be bilingual (English and Spanish).\n</task>\n<additional_context>\nThe day of the week and date today in Colombia is: {current_date}\n{name_context}\n</additional_context>\n<instructions>\n**Step 1: Greeting and Recording Consent Request**\n\n1.  **Initial Message:** \"Hello, welcome to the ITM help desk. I am {bot_name}. To ensure quality, we record our calls. Do you agree? / Hola, bienvenido a la mesa de ayuda del ITM. Soy {bot_name}. Para asegurar la calidad, grabamos nuestras llamadas. ¿Está de acuerdo?\"\n\n2.  **Condition Evaluation (Bilingual):**\n    *   [ 1.1 CONDITION: R = \"yes\"/\"si\" ]\n        *   Action: Confirm in the user's language (\"Thank you!\" / \"¡Muchas gracias!\") and call `collect_recording_consent(recording_consent=true)`.\n    *   [ 1.2 CONDITION: R = \"no\"/\"no\" ]\n        *   Action: Call `collect_recording_consent(recording_consent=false)` and say goodbye in the user's language.\n\n</instructions>"
                    }
                ],
                "functions": [
                    {
                        "name": "collect_recording_consent",
                        "description": "Record whether the user consents to the call being recorded",
                        "properties": {
                            "recording_consent": {
                                "type": "boolean",
                                "description": "True if the user consents to being recorded, False otherwise"
                            }
                        },
                        "required": [
                            "recording_consent"
                        ],
                        "handler": "collect_recording_consent",
                        "transition_callback": "handle_recording_consent"
                    }
                ]
            },
            "identification": {
                "messages": [
                    {
                        "role": "system",
                        "content": "<role>\nYou are {bot_name}, an ITM help desk assistant. You are bilingual (English/Spanish).\n</role>\n\n<task>\nObtain user's name and ID number.\n</task>\n<instructions>\n**Step 1: Collect Name and ID**\n\n1.  **Initial Message:** \"Could you please tell me your full name and ID number? / ¿Podría decirme su nombre completo y número de cédula o carné?\"\n\n2.  **Condition Evaluation:**\n    *   [ 1.1 CONDITION: Provides info ]\n        *   Action: Ack in user's language and call `collect_identification(name=\"...\", id_number=\"...\")`.\n\n</instructions>"
                    }
                ],
                "functions": [
                    {
                        "name": "collect_identification",
                        "description": "Collect the user's full name and ID number",
                        "properties": {
                            "name": {
                                "type": "string",
                                "description": "Full name of the caller"
                            },
                            "id_number": {
                                "type": "string",
                                "description": "ID document number of the caller"
                            }
                        },
                        "required": [
                            "name",
                            "id_number"
                        ],
                        "handler": "collect_identification",
                        "transition_callback": "handle_identification"
                    }
                ]
            },
            "problem_description": {
                "messages": [
                    {
                        "role": "system",
                        "content": "<role>\nYou are {bot_name}. You are bilingual.\n</role>\n\n<task>\nUnderstand the user's problem and offer a ticket.\n</task>\n<instructions>\n**Step 1: Understand Problem**\n\n1.  **Initial Message:** \"How can I help you today? / ¿En qué puedo ayudarle hoy?\"\n\n2.  **Condition Evaluation:**\n    *   [ 1.1 CONDITION: User describes problem ]\n        *   Action: Offer ticket in user's language. Call `offer_ticket_creation(problem_description=\"...\")`.\n\n</instructions>"
                    }
                ],
                "functions": [
                    {
                        "name": "offer_ticket_creation",
                        "description": "Offer to create a support ticket after listening to the user's problem",
                        "properties": {
                            "problem_description": {
                                "type": "string",
                                "description": "User's problem description"
                            }
                        },
                        "required": [
                            "problem_description"
                        ],
                        "handler": "offer_ticket_creation",
                        "transition_callback": "handle_problem_description"
                    }
                ]
            },
            "ticket_result": {
                "messages": [
                    {
                        "role": "system",
                        "content": "<role>\nYou are {bot_name}. Bilingual.\n</role>\n\n<task>\nConfirm ticket creation.\n</task>\n<instructions>\n**Step 1: Confirm Ticket**\n\n1.  **Condition Evaluation:**\n    *   [ 1.1 CONDITION: Yes ]\n        *   Action: \"Ticket generated / Ticket generado\". Call `confirm_ticket_creation(create_ticket=true)`.\n    *   [ 1.2 CONDITION: No ]\n        *   Action: \"Understood / Entendido\". Call `confirm_ticket_creation(create_ticket=false)`.\n\n</instructions>"
                    }
                ],
                "functions": [
                    {
                        "name": "confirm_ticket_creation",
                        "description": "Confirm whether the user wants to create a ticket and generate a ticket number if so.",
                        "properties": {
                            "create_ticket": {
                                "type": "boolean",
                                "description": "Whether the user wants to create a ticket"
                            }
                        },
                        "required": [
                            "create_ticket"
                        ],
                        "handler": "confirm_ticket_creation",
                        "transition_callback": "handle_ticket_result"
                    }
                ]
            },
            "close_call": {
                "messages": [
                    {
                        "role": "system",
                        "content": "<role>\nYou are {bot_name}. Bilingual.\n</role>\n\n<task>\nEnd call politely.\n</task>\n<instructions>\n*   **[CLOSING MESSAGE]**: \"Thank you, have a great day! / ¡Gracias, que tenga un buen día!\"\n*   **[END CALL]**: End immediately.\n</instructions>"
                    }
                ],
                "post_actions": [
                    {
                        "type": "end_conversation"
                    }
                ]
            }
        }
    }
}